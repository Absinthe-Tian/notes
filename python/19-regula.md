---
title: 19.正则表达式
date: 2022-10-19 00:00:00
categories: Python语言
tags:
  - 正则表达式
  - regular
  - pattern
---

正则表达式是一个特殊的字符序列，它能帮助你方便的检查一个字符串是否与某种模式匹配。

正则表达式并不是Python特有的性质，而是各大编程语言通用的特性与写法，只需要调用各大编程语言独有的函数或方法即可实现正则表达式的匹配规则。

# 三大核心

## 字符

### 匹配固定字符

```python
# 只匹配 固定字符
pattern = "固定字符"
```

### 匹配集合字符

```python
# 匹配 a or 1 字符
pattern = "[a1]"

# 匹配 not (a or 1) 字符
pattern = "[^a1]"

# 匹配 [a, z] [A, Z] [0-9] 区间字符
pattern = "[a-z]"
pattern = "[A-Z]"
pattern = "[0-9]"
```

### 匹配特殊字符

```python
# 匹配 除换行符的任意一个字符
pattern = "."

# 匹配 字母、数字、下划线（汉字）
pattern = "\w"

# 匹配 数字
pattern = "\d"

# 匹配 空白符（换行符\n、制表符\t、回车符\r、换页符\f）
pattern = "\s"
```

> 特殊字符可以使用大写，表示取反（非）。

### 匹配转义字符

部分字符在正则表达式中有其特有的意义，如`.`代表任意字符，那么如果要匹配"."，则需要使用到`\.`来进行转义。

### 匹配字符串起始

```python
# 匹配字符串开头
pattern = "^"

# 匹配字符串结尾
pattern = "$"
```

> 一般运用在用户输入的字符串校验中，要求更为严格的匹配。

## 数量

### 匹配模糊次数

```python
# 匹配 0次 或 1次
pattern = "?"

# 匹配 0次 或 n次
pattern = "*"

# 匹配 1次 或 n次
pattern = "+"
```

> 量词默认使用贪婪匹配，可以在量词后面加上一个`?`，那么就是使用非贪婪匹配。
> 
> 贪婪匹配：最大程度匹配，如果有多个匹配结果，那么就取字符最多最长的作为匹配结果。
> 非贪婪匹配：最小程度匹配，如果有多个匹配结果，那么就取字符最少最短的作为匹配结果。

### 匹配指定次数

```python
# 匹配 指定n 次
pattern = "{n}"

# 匹配 [n, +∞) 次
pattern = "{n,}"

# 匹配 [n, m] 次
pattern = "{n,m}"
```

## 分组

### 提取数据

```python
string_example = "Email：2677232159@qq.com"

# 一组提取
pattern = "(\d+)@qq.com" # ['2677232159']

# 多组提取
pattern = "(\d+)@(\w+.\w+)" # [('2677232159', 'qq.com')]

# 嵌套提取
pattern = "\d+@((\w+).\w+)" # [('qq.com', 'qq')]
```

### 分组或

```python
string_example = "2677232159@qq.com, tmt20010201@163.com"

# 匹配其中之一并提取
pattern = "(\w+@(qq|163)\.\w+)" # [('2677232159@qq.com', 'qq'), ('tmt20010201@163.com', '163')]
```

### 命名分组

```python
pattern = "(?P<name>表达式)"
```

> 一般与`finditer`搭配，根据`item.groupdict()`可见分组名。

# 常见的正则

此处正则一般用于用户输入进行校验。

* 身份证：`^[1-9]\d{5}(18|19|20)\d{2}(0[1-9]|1[0-2])(0[1-9]|[1-2]\d|3[01])\d{3}(\d|X|x)$`
* 手机号：`^1[3-9]\d{9}$`
* 邮箱：`^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$`
* 日期：`^\d{4}-\d{1,2}-\d{1,2}$`
* QQ：`^[1-9]\d{4,10}$`
* 银行卡：`^\d{16,19}$`
* 汉字：`^[\u4e00-\u9fa5]+$`
* 用户名：`^[a-zA-Z0-9_]{6,20}$`
* URL：`^(http|https):\/\/[^\s/$.?#].[^\s]*$`
* IPV4：`^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$`
* IPV6：`^(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$`

# re模块

re模块提供了很多方法来处理正则表达式。

## 常用方法

### re方法

* `re.compile(pattern, flags=0)`：返回一个预编译正则表达式对象，该对象拥有一系列匹配方法，都可以使用此处的pattern。
* `re.match(pattern, string, flags=0)`：从字符串的起始位置匹配，成功返回一个匹配对象，否则返回None。
* `re.search(pattern, string, flags=0)`：扫描整个字符串并返回第一个成功的匹配对象。
* `re.findall(pattern, string, flags=0)`：在字符串中找到正则表达式所匹配的所有子串，并返回一个列表。
* `re.finditer(pattern, string, flags=0)`：和findall类似，但返回的是一个迭代器，每个元素都是一个匹配对象，包含更多的信息。
* `re.split(pattern, string, maxsplit=0, flags=0)`：使用正则表达式来分割字符串。
* `re.sub(pattern, repl, string, count=0, flags=0)`：使用正则表达式在字符串中进行查找，并使用指定的字符串替换掉查找到的内容。
* `re.subn(pattern, repl, string, count=0, flags=0)`：和sub方法类似，但是返回一个元组，第一个元素是替换后的字符串，第二个元素是替换的次数。

### Match方法：

当匹配成功时返回一个 Match 对象

* `group([group1, …])`：方法用于获得一个或多个分组匹配的字符串，当要获得整个匹配的子串时，可直接使用 group() 或 group(0)；
* `start([group])`：方法用于获取分组匹配的子串在整个字符串中的起始位置（子串第一个字符的索引），参数默认值为 0；
* `end([group])`：方法用于获取分组匹配的子串在整个字符串中的结束位置（子串最后一个字符的索引+1），参数默认值为 0；
* `span([group])`：方法返回 (start(group), end(group))。

## flags可选标志

| 修饰符 | 描述 |
| :---: | :---: |
| re.I | 使匹配对大小写不敏感 |
| re.L | 做本地化识别（locale-aware）匹配 |
| re.M | 多行匹配，影响 ^ 和 $ |
| re.S | 使 . 匹配包括换行在内的所有字符 |
| re.U | 根据Unicode字符集解析字符。这个标志影响 \w, \W, \b, \B. |
| re.X | 该标志通过给予你更灵活的格式以便你将正则表达式写得更易于理解。 |

# 速查表

| 符号 | 描述 |
| :---: | :---: |
| . | 匹配除了换行符之外的任何字符 |
| * | 匹配前面的子表达式零次或多次 |
| + | 匹配前面的子表达式一次或多次 |
| ? | 匹配前面的子表达式零次或一次 |
| {n} | n是一个非负整数。匹配确定的n次 |
| {n,} | n是一个非负整数。至少匹配n次 |
| {n,m} | m和n均为非负整数，其中n <= m。最少匹配n次且最多匹配m次 |
| \d | 匹配一个数字字符。等价于`[0-9]` |
| \D | 匹配一个非数字字符。等价于`[^0-9]` |
| \s | 匹配空白字符，包括空格、制表符、换页符等等。等价于`[\f\n\r\t\v]` |
| \S | 匹配非空白字符。等价于`[^\f\n\r\t\v]` |
| \w | 匹配一个数字、字母或下划线。等价于`[A-Za-z0-9_]` |
| \W | 匹配一个非单词字符。等价于`[^A-Za-z0-9_]` |
| ^ | 匹配输入字符串的开始位置 |
| $ | 匹配输入字符串的结束位置 |
| [abc] | 匹配方括号内的任何字符 |
| [^abc] | 匹配除了方括号内字符的任何字符 |
| (pattern) | 分组匹配pattern并捕获该匹配的子字符串。可以使用\number对捕获的子字符串进行引用 |
| \| | 匹配该符号前后的任一表达式 |
| \number | 匹配number指定的捕获 |
